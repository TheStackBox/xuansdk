// the kurobox library
// simple api class for easing developer works
// function:
// handle tokens
// call api
(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['exports', 'jquery'], function(exports, $) {
        	root.Kurobox = factory(root, exports, $);
        });
    } else if (typeof exports === 'object') {
        // CommonJS
        var $ = require('jquery')
        factory(root, exports, $);
    } else {
        // Browser globals
       root.Kurobox = factory(root, {}, root.jQuery);
    }
}(this, function (root, Kurobox, $) {
    'use strict'

    // initial setup
    var session = null;

    Kurobox.host = '//127.0.0.1:1111';
    Kurobox.appName = null;

    Kurobox.getSession = function() {
    	return this.session;
    };

    Kurobox.login = function(username, password, callback) {
    	// login to the kurobox
    	Kurobox.api(null, 'login', {username: username, password:password}, callback);
    };

    Kurobox.api = function(method, parameter, callback) {
    	if (session === null) {
    		// no session available, require login
    		callback({returnValue:500, message: 'Login required'});
    	} else {
    		// app process is unknown

    		// send data
    		var url = Kurobox.host + '?func='+method;
    		$.post(Kurobox.host+'func='+method, parameter, function(json, textStatus) {
    			/*optional stuff to do after success */
    		});
    	}
    };

}));